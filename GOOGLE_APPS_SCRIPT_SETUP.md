# ุฅุนุฏุงุฏ Google Apps Script ูููููุฐุฌ
## ุญู ูุดููุฉ 401 Unauthorized

---

## ๐ด ุงููุดููุฉ

Google Sheets API ูุชุทูุจ OAuth2 ูููุชุงุจุฉุ ูุงูููุชุงุญ API Key ูุญุฏู ูุง ูููู. 

---

## โ ุงูุญู: Google Apps Script Web App

### ุงูุทุฑููุฉ ุงูุฃููู: Google Apps Script (ููุตู ุจู)

#### ุงูุฎุทูุฉ 1: ุฅูุดุงุก Apps Script

1. **ุงูุชุญ Google Sheet:**
   ```
   https://docs.google.com/spreadsheets/d/1MySbmF_IA13IjtpCs2hRIFkJqWVGxRcdhiahvaEDXao/edit
   ```

2. **ุงูุชุญ Apps Script:**
   - Extensions โ Apps Script
   - ุฃู Tools โ Script editor

3. **ุฃูุดุฆ ูุฑูุฉ "ุงูุชููููุงุช":**
   - ูู Google Sheetุ ุฃูุดุฆ ูุฑูุฉ ุฌุฏูุฏุฉ
   - ุงุณููุง: `ุงูุชููููุงุช`

#### ุงูุฎุทูุฉ 2: ูุณุฎ ุงูููุฏ

ุงุญุฐู ุงูููุฏ ุงูููุฌูุฏ ูุงูุตู ูุฐุง:

```javascript
function doPost(e) {
  try {
    // Get the active spreadsheet
    const sheet = SpreadsheetApp.openById('1MySbmF_IA13IjtpCs2hRIFkJqWVGxRcdhiahvaEDXao')
                                 .getSheetByName('ุงูุชููููุงุช');
    
    // Parse incoming data
    const data = JSON.parse(e.postData.contents);
    
    // Check if headers exist, if not create them
    if (sheet.getLastRow() === 0) {
      const headers = [
        'ุงูุชุงุฑูุฎ ูุงูููุช',
        'ุงุณู ุงูุดุฑูุฉ',
        'ููุน ุงููุดุงุท',
        'ุชุงุฑูุฎ ุงูุชุฃุณูุณ',
        'ุงูุนููุงู ุงูุฑุฆูุณู',
        'ุงูุณุฌู ุงูุชุฌุงุฑู',
        'ุงูุจุทุงูุฉ ุงูุถุฑูุจูุฉ',
        'ุนููุฏ ุงูุงุณุชุซูุงุฑ',
        'ุงูุชุฑุงุฎูุต ุงูุชุดุบูููุฉ',
        'ุฑุงุจุท ุงูุณุฌู ุงูุชุฌุงุฑู',
        'ุฑุงุจุท ุงูุจุทุงูุฉ ุงูุถุฑูุจูุฉ',
        'ุฑุงุจุท ุนููุฏ ุงูุงุณุชุซูุงุฑ',
        'ุฑุงุจุท ุงูุชุฑุงุฎูุต',
        'ูููู ุชูุธููู ูุนุชูุฏ',
        'ุฑุงุจุท ุงููููู ุงูุชูุธููู',
        'ุฃุตุญุงุจ ุงูุตูุงุญูุงุช',
        'ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ',
        'ุงููุธุงู ุงููุญุงุณุจู',
        'ูุธุงู ูุญุงุณุจู ุขุฎุฑ',
        'ููุฒุงููุงุช ูุฏููุฉ',
        'ุงูุฏูุฑุฉ ุงููุณุชูุฏูุฉ',
        'ุงูุณูููุฉ ุงููุงููุฉ',
        'ุณูุณูุฉ ุงูุชูุฑูุฏ',
        'ุฃุฏูุฉ ุงูุณูุงุณุงุช SOPs',
        'ุงูุชุญุฏูุงุช ุงูุชุดุบูููุฉ',
        'ุงูุจุฑุงูุฌ ูุงูุชูููุงุช',
        'ุญูุงูุฉ ุงูุจูุงูุงุช',
        'ุงูุจููุฉ ุงูุชุญุชูุฉ',
        'ุนุฏุฏ ุงูููุธููู ุงูุฏุงุฆููู',
        'ุนุฏุฏ ุงูููุธููู ุงููุคูุชูู',
        'ุงููุงุฆุญุฉ ุงูุฏุงุฎููุฉ',
        'ุชูููู ุงูุฃุฏุงุก ูุณูู ุงูุฑูุงุชุจ',
        'ูุณุจุฉ ุฏูุฑุงู ุงูุนูุงูุฉ',
        'ููุงุญุธุงุช ุฅุถุงููุฉ'
      ];
      sheet.appendRow(headers);
    }
    
    // Prepare row data
    const row = [
      data.timestamp || new Date().toLocaleString('ar-EG'),
      data.companyName || '',
      data.businessType || '',
      data.establishmentDate || '',
      data.mainAddress || '',
      data.doc1 || '',
      data.doc2 || '',
      data.doc3 || '',
      data.doc4 || '',
      data.file1_url || '',
      data.file2_url || '',
      data.file3_url || '',
      data.file4_url || '',
      data.orgChart || '',
      data.file5_url || '',
      data.authorities || '',
      data.decisionMaking || '',
      data.accountingSystem || '',
      data.accountingSystemOther || '',
      data.auditedBudgets || '',
      data.documentCycle || '',
      data.liquidity || '',
      data.supplyChain || '',
      data.sops || '',
      data.operationalChallenges || '',
      data.itSystems || '',
      data.dataProtection || '',
      data.infrastructure || '',
      data.permanentEmployees || '',
      data.temporaryEmployees || '',
      data.internalRegulations || '',
      data.performanceEvaluation || '',
      data.turnoverRate || '',
      data.additionalNotes || ''
    ];
    
    // Append the row
    sheet.appendRow(row);
    
    // Return success
    return ContentService.createTextOutput(JSON.stringify({
      'status': 'success',
      'message': 'ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ'
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    // Return error
    return ContentService.createTextOutput(JSON.stringify({
      'status': 'error',
      'message': error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

// Test function
function doGet(e) {
  return ContentService.createTextOutput('Apps Script is running!');
}
```

#### ุงูุฎุทูุฉ 3: ุงููุดุฑ

1. **ุงุถุบุท Deploy (ุงููุดุฑ):**
   - Deploy โ New deployment

2. **ุงุฎุชุฑ ุงูููุน:**
   - Type: Web app

3. **ุงูุฅุนุฏุงุฏุงุช:**
   - Description: "Al-Hokamaa Evaluation Form Backend"
   - Execute as: **Me** (ุจุฑูุฏู ุงูุฅููุชุฑููู)
   - Who has access: **Anyone** (ููู!)

4. **ุงุถุบุท Deploy:**
   - ุณุชุญุชุงุฌ ููููุงููุฉ ุนูู ุงูุตูุงุญูุงุช
   - Authorize access
   - ุงุฎุชุฑ ุญุณุงุจู
   - ุงุถุบุท "Advanced" โ "Go to [project name] (unsafe)"
   - ุงุถุบุท "Allow"

5. **ุงูุณุฎ ุงูุฑุงุจุท:**
   - ุณูุธูุฑ ูู Web app URL
   - ูุซุงู: `https://script.google.com/macros/s/AKfycbx.../exec`
   - **ุงูุณุฎู!**

#### ุงูุฎุทูุฉ 4: ุชุญุฏูุซ config.js

ุงูุชุญ ููู `config.js` ูุญุฏูุซ:

```javascript
const CONFIG = {
    // ... ุจุงูู ุงูุฅุนุฏุงุฏุงุช
    
    // ุถุน ุงูุฑุงุจุท ููุง
    APPS_SCRIPT_URL: 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec',
    
    // ุนุทูู FormSubmit
    USE_FORMSUBMIT: false,
    
    // ... ุจุงูู ุงูุฅุนุฏุงุฏุงุช
};
```

---

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุงุณุชุฎุฏุงู FormSubmit (ุงูุญู ุงูุญุงูู - ูุคูุช)

ุญุงููุงู ุงููุธุงู ูุถุจูุท ุนูู ุงุณุชุฎุฏุงู FormSubmit.co ูุญู ูุคูุช.

#### ุงููููุฒุงุช:
- โ ูุง ูุญุชุงุฌ ุฅุนุฏุงุฏ
- โ ูุนูู ููุฑุงู
- โ ุชุฑุณู ุงูุจูุงูุงุช ููุจุฑูุฏ ุงูุฅููุชุฑููู

#### ุงูุนููุจ:
- โ ูุง ุชุฐูุจ ูุจุงุดุฑุฉ ูู Google Sheets
- โ ุชุญุชุงุฌ ูุณุฎ ูุฏูู ููุจูุงูุงุช

#### ููู ูุนูู:
1. ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ
2. ุงูุจูุงูุงุช ุชูุฑุณู ูู FormSubmit.co
3. FormSubmit ูุฑุณู ุจุฑูุฏ ุฅููุชุฑููู ูู `info@alhokamaa.com`
4. ููููู ูุณุฎ ุงูุจูุงูุงุช ูุฏููุงู ููู Sheet

#### ูุชูุนููู:
- **ููุนูู ุญุงููุงู** ูู config.js
- ุณูุตูู ุจุฑูุฏ ุฅููุชุฑููู ุนูุฏ ูู submission
- ูู ุชุญุชุงุฌ ุชุฃููุฏ ุงูุจุฑูุฏ ูู ุฃูู ุงุณุชุฎุฏุงู

---

### ุงูุทุฑููุฉ ุงูุซุงูุซุฉ: Webhook Services (ุจุฏูู)

ูููู ุงุณุชุฎุฏุงู ุฎุฏูุงุช ูุซู:
- **Zapier**: ูุฑุจุท ุงููููุฐุฌ ุจู Google Sheets
- **Make (Integromat)**: ุฃุชูุชุฉ ูุชูุฏูุฉ
- **n8n**: ููุชูุญ ุงููุตุฏุฑ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ FormSubmit (ุงูุญุงูู):

1. ุงูุชุญ http://localhost:8000
2. ุงููุฃ ุงููููุฐุฌ
3. ุงุถุบุท "ุฅุฑุณุงู ุงูุงุณุชุจูุงู"
4. ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ
5. ุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู `info@alhokamaa.com`

### ุงุฎุชุจุงุฑ Apps Script (ุจุนุฏ ุงูุฅุนุฏุงุฏ):

1. ุชุฃูุฏ ูู ุชุญุฏูุซ `APPS_SCRIPT_URL` ูู config.js
2. ุบููุฑ `USE_FORMSUBMIT: false`
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
4. ุงููุฃ ุงููููุฐุฌ
5. ุงุถุบุท ุฅุฑุณุงู
6. ุชุญูู ูู Google Sheet ูุจุงุดุฑุฉ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### Apps Script ูุง ูุนูู:

**ุงูุฎุทุฃ: 401 Unauthorized**
- ุชุฃูุฏ ูู Who has access = **Anyone**
- ุชุฃูุฏ ูู Execute as = **Me**
- ุฃุนุฏ ุงููุดุฑ (Deploy)

**ุงูุฎุทุฃ: 403 Forbidden**
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุตูู ููู Sheet
- ุชุฃูุฏ ูู ุฃู Apps Script ูููู ุญู ุงููุตูู

**ุงูุฎุทุฃ: CORS**
- ุทุจูุนู! ุงุณุชุฎุฏููุง `mode: 'no-cors'`
- ูุฌุจ ุฃู ูุนูู ุฑุบู ุธููุฑ ุงูุฎุทุฃ ูู Console

### FormSubmit ูุง ูุนูู:

**ูุง ูุตู ุจุฑูุฏ ุฅููุชุฑููู:**
- ุชุญูู ูู ุตูุฏูู Spam
- ุชุญูู ูู ุงูุจุฑูุฏ ูู config.js
- ูู ุฃูู ุงุณุชุฎุฏุงูุ ูุฏ ุชุญุชุงุฌ ุชุฃููุฏ ุงูุจุฑูุฏ

**ุงูุฎุทุฃ: Email not verified**
- ุงูุชุญ ุงูุฑุงุจุท ุงูุฐู ูุตูู ุฃูู ูุฑุฉ
- ุงุถุบุท ุชุฃููุฏ

---

## ๐ ุงูุญู ุงูุณุฑูุน (ุฅุฐุง ููุช ูุณุชุนุฌูุงู)

### ุญุงููุงู (ุจุฏูู ุฅุนุฏุงุฏ):
```javascript
// ูู config.js - ููุฌูุฏ ุจุงููุนู
USE_FORMSUBMIT: true
```
- ูุนูู ููุฑุงู
- ุงูุจูุงูุงุช ุชุตู ููุจุฑูุฏ
- ูุง ูุญุชุงุฌ ุฅุนุฏุงุฏ ุฅุถุงูู

### ููุงุณุชุฎุฏุงู ุงูุฏุงุฆู (10 ุฏูุงุฆู ุฅุนุฏุงุฏ):
1. ุงุชุจุน ุฎุทูุงุช Apps Script ุฃุนูุงู
2. ุงูุณุฎ ุงูุฑุงุจุท
3. ุญุฏูุซ config.js
4. ุบููุฑ `USE_FORMSUBMIT: false`

---

## ๐ ููุงุฑูุฉ ุงูุญููู

| ุงูููุฒุฉ | FormSubmit | Apps Script | Direct API |
|--------|-----------|-------------|------------|
| ุณูููุฉ ุงูุฅุนุฏุงุฏ | โญโญโญโญโญ | โญโญโญ | โญ |
| ุงูุณุฑุนุฉ | โญโญโญโญ | โญโญโญโญ | โญโญโญโญโญ |
| ุงูุฃูุงู | โญโญโญ | โญโญโญโญโญ | โญโญโญ |
| ูุจุงุดุฑ ููู Sheet | โ | โ | โ |
| ูุญุชุงุฌ ุฅุนุฏุงุฏ | โ | โ | โโ |
| ุงูุชูููุฉ | ูุฌุงูู | ูุฌุงูู | ูุฌุงูู |

**ุงูุชูุตูุฉ:** ุงุณุชุฎุฏู FormSubmit ููุงุฎุชุจุงุฑุ ุซู ุงูุชูู ูู Apps Script ููุฅูุชุงุฌ.

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ููุชุฌุฑุจุฉ ุงูููุฑูุฉ:
- โ **ุงูุญู ุงูุญุงูู ูุนูู!** (FormSubmit)
- โ ุณูุตูู ุจุฑูุฏ ุจุงูุจูุงูุงุช
- โ ูุง ุชุญุชุงุฌ ุชุบููุฑ ุฃู ุดูุก

### ููุงุณุชุฎุฏุงู ุงูุฏุงุฆู:
- ๐ง ุฃุนุฏ Apps Script (10 ุฏูุงุฆู)
- ๐ง ุญุฏูุซ config.js
- ๐ง ุงูุจูุงูุงุช ุชุฐูุจ ูุจุงุดุฑุฉ ููู Sheet

---

**ุชู ุงูุชุญุฏูุซ:** 26 ุฏูุณูุจุฑ 2025  
**ุงูุญู ุงูุญุงูู:** FormSubmit (ูุนูู ุงูุขู!)  
**ุงูุญู ุงูููุตู ุจู:** Google Apps Script (ุจุนุฏ ุงูุฅุนุฏุงุฏ)
